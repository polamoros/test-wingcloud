{"version":3,"sources":["../../../../../../../../../.nvm/versions/node/v20.11.1/lib/node_modules/winglang/node_modules/@winglang/sdk/src/helpers.ts","../../../../../../node_modules/@winglibs/websockets/lib.w","../handler_c8aa7f82.sandbox.cjs"],"sourcesContent":["// Code in this file will be automatically included in all inflight code bundles,\n// so avoid importing anything heavy here.\nimport { deepStrictEqual, notDeepStrictEqual } from \"node:assert\";\nimport * as path from \"node:path\";\nimport type { Construct } from \"constructs\";\nimport type { Node } from \"./std/node\";\n\nexport function eq(a: any, b: any): boolean {\n  try {\n    deepStrictEqual(a, b);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport function neq(a: any, b: any): boolean {\n  try {\n    notDeepStrictEqual(a, b);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport function assert(condition: any, message: string): asserts condition {\n  if (!condition) {\n    throw new Error(\"assertion failed: \" + message);\n  }\n}\n\nexport function range(start: number, end: number, inclusive: boolean) {\n  function* iterator() {\n    let i = start;\n    let limit = inclusive ? (end < start ? end - 1 : end + 1) : end;\n    while (i < limit) yield i++;\n    while (i > limit) yield i--;\n  }\n  return iterator();\n}\n\nexport function nodeof(construct: Construct): Node {\n  // Should only be used preflight, avoid bundling\n  const Node = eval(\"require('./std/node').Node\");\n  return Node.of(construct);\n}\n\nexport function normalPath(p: string): string {\n  return p.replace(/\\\\+/g, \"/\");\n}\n\nexport function unwrap<T>(value: T): T | never {\n  if (value != null) {\n    return value;\n  }\n  throw new Error(\"Unexpected nil\");\n}\n\nexport function lookup(obj: any, index: string | number): any {\n  checkIndex(index);\n\n  if (typeof index === \"number\") {\n    index = checkArrayAccess(obj, index);\n    return obj[index];\n  }\n\n  if (typeof obj !== \"object\") {\n    throw new TypeError(\n      `Lookup failed, value is not an object (found \"${typeof obj}\")`\n    );\n  }\n\n  if (!(index in obj)) {\n    throw new RangeError(`Key \"${index}\" not found`);\n  }\n\n  return obj[index];\n}\n\nexport function assign(\n  obj: any,\n  index: string | number,\n  kind: \"=\" | \"+=\" | \"-=\",\n  value: any\n) {\n  checkIndex(index);\n\n  if (typeof index === \"number\") {\n    index = checkArrayAccess(obj, index);\n  }\n\n  if (typeof index === \"string\" && typeof obj !== \"object\") {\n    throw new TypeError(\n      `Assignment failed, value is not an object (found \\\"${typeof obj}\\\")`\n    );\n  }\n\n  switch (kind) {\n    case \"=\":\n      obj[index] = value;\n      break;\n    case \"+=\":\n      obj[index] += value;\n      break;\n    case \"-=\":\n      obj[index] -= value;\n      break;\n    default:\n      throw new Error(`Invalid assignment kind: ${kind}`);\n  }\n}\n\nfunction checkIndex(index: string | number) {\n  if (typeof index !== \"string\" && typeof index !== \"number\") {\n    throw new TypeError(\n      `Index must be a string or number (found \"${typeof index}\")`\n    );\n  }\n}\n\nfunction checkArrayAccess(obj: any, index: number): number {\n  if (!Array.isArray(obj) && !Buffer.isBuffer(obj) && typeof obj !== \"string\") {\n    throw new TypeError(\n      \"Index is a number but collection is not an array or string\"\n    );\n  }\n  if (index < 0 && index >= -obj.length) {\n    index = obj.length + index;\n  }\n  if (index < 0 || index >= obj.length) {\n    throw new RangeError(\n      `Index ${index} out of bounds for array of length ${obj.length}`\n    );\n  }\n  return index;\n}\n\nexport function createExternRequire(dirname: string) {\n  return (externPath: string) => {\n    // using eval to always avoid bundling\n    const jiti: typeof import(\"jiti\").default = eval(\"require('jiti')\");\n    const esbuild: typeof import(\"esbuild\") = eval(\"require('esbuild')\");\n\n    const newRequire = jiti(dirname, {\n      sourceMaps: true,\n      interopDefault: true,\n      transform(opts) {\n        return esbuild.transformSync(opts.source, {\n          format: \"cjs\",\n          target: \"node20\",\n          sourcemap: \"inline\",\n          loader: opts.ts ? \"ts\" : \"js\",\n        });\n      },\n    });\n    return newRequire(externPath);\n  };\n}\n\nexport function resolveDirname(\n  outdir: string,\n  relativeSourceDir: string\n): string {\n  return normalPath(path.resolve(outdir, relativeSourceDir));\n}\n","bring util;\nbring cloud;\nbring ui;\nbring \"./commons/api.w\" as api;\nbring \"./platform/awscdk.w\" as awscdk;\nbring \"./platform/tf-aws.w\" as tfaws;\nbring \"./platform/sim.w\" as sim;\n\npub class WebSocket impl api.IWebSocket {\n  inner: api.IWebSocket;\n  pub url: str;\n  \n  new(props: api.WebSocketProps) {\n    let target = util.env(\"WING_TARGET\");\n\n    if target == \"tf-aws\" {\n      let ws = new tfaws.WebSocket_tfaws(props) as props.name;\n      this.url = ws.url;\n      this.inner = ws;\n    } elif target == \"awscdk\" {\n      let ws = new awscdk.WebSocket_awscdk(props) as props.name;\n      this.url = ws.url;\n      this.inner = ws;\n    } elif target == \"sim\" {\n      let ws = new sim.WebSocket_sim(props) as props.name;\n      this.url = ws.url;\n      this.inner = ws;\n    } else {\n      throw \"unsupported target {target}\";\n    }\n\n    let inner = nodeof(this.inner);\n    inner.hidden = true;\n\n    new ui.Field(\"url\", inflight () => {\n      return this.url;\n    });\n\n    new cloud.Endpoint(this.url);\n  }\n\n  pub onConnect(handler: inflight(str): void): void {\n    this.inner.onConnect(handler);\n  }\n  pub onDisconnect(handler: inflight(str): void): void {\n    this.inner.onDisconnect(handler);\n  }\n  pub onMessage(handler: inflight(str, str): void): void {\n    this.inner.onMessage(handler);\n  }\n\n  pub inflight sendMessage(connectionId: str, message: str) {\n    this.inner.sendMessage(connectionId, message);\n  }\n}\n","\"use strict\";\nvar $handler = undefined;\nexports.handler = async function(event) {\n  $handler = $handler ?? (\n          (await (async () => {\n            const $Closure1Client = \n          require(\"/Users/polamoros/Projects/WingCloud/test-wingcloud/backend/target/test/main.wsim/.wing/inflight.$Closure1-7.cjs\")({\n            $__parent_this_1_url: process.env[\"WING_TOKEN_WSIM_ROOT_ENV0_BROADCASTER_COUNTER_UPDATES_COUNTER_UPDATES_STATE_ATTRS_URL\"],\n          })\n        ;\n            const client = new $Closure1Client({\n            });\n            if (client.$inflight_init) { await client.$inflight_init(); }\n            return client;\n          })())\n        );\n  return await $handler.handle(event);\n};\nprocess.on(\"uncaughtException\", (reason) => {\n  process.send({ type: \"error\", reason });\n});\n\nprocess.on(\"message\", async (message) => {\n  const { fn, args } = message;\n  const value = await exports[fn](...args);\n  process.send({ type: \"ok\", value });\n});\n"],"mappings":"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","names":["exports","module"]}